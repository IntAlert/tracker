<html>
    <head>
        <title>Log In</title>
        <script src='https://cdn.firebase.com/js/client/2.0.4/firebase.js'></script>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
        <script src='https://code.jquery.com/ui/1.11.4/jquery-ui.min.js'></script>
        <link rel="stylesheet" href="styles/jquery-ui.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="styles/index.css" type="text/css">
        
        <style>
		.dlg-no-close .ui-dialog-titlebar-close {
			display: none;
		}
        </style>
    </head>
    
    <body onload="firstRun()">
        <div id="dialogEmail" title="Error">Please enter an email address.</div>
        <div id="dialogPass" title="Error">Please enter a password.</div>
        
        <div class="page-header container text-center">
            <h1>International Alert Security App</h1>
        </div>
        <div class="container text-center">
            <h3>Log In</h3>
        </div>
        <div id="container" class="info">
            <p>Email Address
            <input class="textbox" type="email" id="name" placeholder="Enter your email" value="dlucas@international-alert.org">
            </p>
            <p>Password
            <input class="textbox" type="password" id="password" placeholder="Enter your password">
            </p>
            <button onClick="forgotPass()" class="forgotpass">Forgot Password</button>
            <br>
        </div>
        <button class="submit" onclick="authMe()">Login</button>
        
        <!-- ==================== SCRIPTS ==================== -->
        <script>
            ////////// DIALOG \\\\\\\\\\
            $(function() {
                $( "#dialogEmail" ).dialog({
                    autoOpen: false,
                    modal: true,
                    dialogClass: "dlg-no-close",
                    buttons: {
                        "OK": function() {
                            $( this ).dialog( "close" );
                        }
                    }
                });
            });
            
            $(function() {
                $( "#dialogPass" ).dialog({
                    autoOpen: false,
                    modal: true,
                    dialogClass: "dlg-no-close",
                    buttons: {
                        "OK": function() {
                            $( this ).dialog( "close" );
                        }
                    }
                });
            });
            
            
            ////////// MAIN SCRIPTS \\\\\\\\\\
                        
            function firstRun() {
                var status = localStorage.getItem("status")
                if (status === null || status.length === 0){
                    window.location="create.html";
                }
            }
      
            function authMe() {
            username = document.getElementById("name").value;
            if(typeof(Storage) !== "undefined") {
                        sessionStorage.setItem("email", username);
            }
            password = document.getElementById("password").value;
            if (username === "") {
                $( "#dialogEmail" ).dialog( "open" );
                //alert("Please enter a username");
               return;
            } else {
            if (password === "") {
                $( "#dialogPass" ).dialog( "open" );
                //alert("Please enter a password");
               return;
            } else {
                var ref = new Firebase("https://crackling-fire-1447.firebaseio.com/contacts");
                    ref.authWithPassword({
                        "email": username,
                        "password": password
                        }, authHandler);
                    }
                }
            }

        // Create a callback to handle the result of the authentication
            function authHandler(error, authData) {
            if (error) {
                alert("Login Failed! " + error);
            } else {
                window.location="main.html";
            }
        }

            function forgotPass() {
                window.location="forgot.html";
            }
        </script>
        <!-- ================================================= -->        
    </body>
</html>