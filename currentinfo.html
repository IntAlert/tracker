<html>
    <head>
        <title>View Current Info</title>
        <script src='https://cdn.firebase.com/js/client/2.0.4/firebase.js'></script>
        <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
        <script src='https://code.jquery.com/ui/1.11.4/jquery-ui.min.js'></script>
        <link rel="stylesheet" href="styles/jquery-ui.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="styles/currentinfo.css" type="text/css">
        
        <style>
		.dlg-no-close .ui-dialog-titlebar-close {
			display: none;
		}
        #dialogError {
            display: none;   
        }
        </style>
    </head>
    
    <body>
        <div id="dialogError" title="Error">Local Storage not supported.</div>
        
        <div class="page-header container text-center">
            <h1>International Alert Security App</h1>
        </div>
        <div class="container text-center">
            <h3>Current Trip Info</h3>
        </div>
        <div id="container" class="container text-center">
            <div class="container text-center">
                <p id="trip"></p>
                <br>
            </div>
            <form name="back" action="main.html">
                <input class="backbutton" type="submit" value="Back">
            </form>
        </div>
        
        <!-- ==================== SCRIPTS ==================== -->             
        <script>
            ////////// DIALOG \\\\\\\\\\
            $(function() {
                $( "#dialogError" ).dialog({
                    autoOpen: false,
                    modal: true,
                    dialogClass: "dlg-no-close",
                    buttons: {
                        "OK": function() {
                            $( this ).dialog( "close" );
                        }
                    }
                });
            });
            
            
            ////////// MAIN SCRIPTS \\\\\\\\\\
            var myID = ""; // THIS IS GLOBAL!!!!!!!!!
            var uName = "";
            var email = sessionStorage.getItem("email");
            function authDataCallback(authData) {
                if (authData) {
                myID = authData.uid.substring(12,16);
                } 
            }  
            // Register the callback to be fired every time auth state changes
            var ref = new Firebase("https://crackling-fire-1447.firebaseio.com/");
            ref.onAuth(authDataCallback);
            
            var count = 0;
            var triggered = false;
            var trip = [];
            var myText = "";
            var ref = new Firebase("https://crackling-fire-1447.firebaseio.com/trips");
            ref.orderByChild("email").equalTo(email).on("child_added", function(snapshot) {
            newTrip = snapshot.val();
            trip[count] = new Array(4);
            trip[count][1] = newTrip.destination;
            trip[count][2] = newTrip.leave;
            trip[count][3] = newTrip.back;
            trip[count][4] = snapshot.key();
            myText += "<button onClick='displayTrip("+count+")' id='trips'><b>Destination: </b>" + trip[count][1] + "<br><b>Departing: </b>" + trip[count][2] + "<br><b>Returning: </b>" + trip[count][3] + "</button>";
            count = count + 1;
            if(count>5 && triggered == false) {
                triggered = true;
                myText = '<form name="back" action="main.html"><input class="backbutton" type="submit" value="Back"></form><br>' + myText;
            }
            document.getElementById("trip").innerHTML = myText;    
            });
            
            function displayTrip(count) {
                if(typeof(Storage) !== "undefined") {
                    sessionStorage.setItem("thistripid", trip[count][4]);
                    window.location = "mytrip.html";
                } else {
                    $( "#dialogError" ).dialog( "open" );
                }
            }
            </script>
    </body>
</html>